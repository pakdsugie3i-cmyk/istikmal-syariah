<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Halaman 2 - Istikmal Syariah</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="assets/logo.png" type="image/png" />
</head>
<body>
  <div class="container">
    <div class="top">
      <img src="assets/logo.png" alt="Logo Istikmal" class="logo" />
      <h1>Formulir Istikmal Syariah<br><span class="sub">â€“ 3IReborn</span></h1>
      <p>Lengkapi data tambahan & kirim ke leader Anda.</p>
    </div>
    <div class="card">
      <h2>Halaman 2 â€“ Data Tambahan</h2>
      <h3>Lengkapi Data & Kirim</h3>

      <h3>Upload Foto e-KTP ðŸ“¸</h3>
      <label for="ktp">Foto KTP (wajib, max 5MB)</label>
      <input type="file" id="ktp" accept="image/*" required>
      <div id="ktpPreview"></div>
      <br>

      <label for="alamatDom">Alamat Domisili (jika berbeda)</label>
      <input type="text" id="alamatDom" placeholder="Contoh: Sama dengan KTP" />

      <label for="pekerjaan">Pekerjaan</label>
      <input type="text" id="pekerjaan" placeholder="Contoh: Wiraswasta" required />

      <label for="penghasilan">Penghasilan /bulan</label>
      <input type="text" id="penghasilan" placeholder="Contoh: <50 jt" required />

      <label for="namaBank">Nama Bank</label>
      <input type="text" id="namaBank" placeholder="Contoh: BCA" required />

      <label for="noRek">No Rekening</label>
      <input type="text" id="noRek" placeholder="Contoh: 764621702" required />

      <label for="namaAhli">Nama Ahli Waris</label>
      <input type="text" id="namaAhli" placeholder="Contoh: Asha Kaba Aira (anak)" required />

      <label for="hubAhli">Hubungan Ahli Waris</label>
      <input type="text" id="hubAhli" placeholder="Contoh: Anak" required />

      <label for="kesehatan">Kesehatan (merokok?)</label>
      <select id="kesehatan" required>
        <option value="">Pilih</option>
        <option value="Tidak merokok">Tidak merokok</option>
        <option value="Merokok ringan">Merokok ringan</option>
        <option value="Merokok berat">Merokok berat</option>
      </select>

      <div class="confirm-box">
        <p>âœ… Saya setuju data benar & siap closing mitra Istikmal Syariah.</p>
      </div>

      <div class="actions two">
        <button id="backTo1" class="btn light">â¬… Kembali</button>
        <button id="kirim" class="btn primary">Kirim ke Leader ðŸš€</button>
      </div>
    </div>
    <div class="foot">Â© 2025 3IReborn â€“ Form Digital MLM Syariah</div>
  </div>

  <script src="leader.js"></script>
  <script>
    const data1 = JSON.parse(localStorage.getItem('formData')) || {};
    let ktpBase64 = '';
    document.getElementById('ktp').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.size < 5000000) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          ktpBase64 = ev.target.result;
          document.getElementById('ktpPreview').innerHTML = `<img src="${ktpBase64}" style="max-width:100%; border-radius:15px; border:4px solid #00b09b; box-shadow:0 0 30px #00b09b;">`;
        };
        reader.readAsDataURL(file);
      } else alert('File besar/bukan gambar!');
    });

    document.getElementById('backTo1').onclick = function() {
      const params = new URLSearchParams(window.location.search);
      const leader = params.get('leader') ? '?leader=' + params.get('leader') : '';
      window.location.href = "index.html" + leader;
    };

    document.getElementById('kirim').onclick = function() {
      const data2 = {
        alamatDom: document.getElementById('alamatDom').value,
        pekerjaan: document.getElementById('pekerjaan').value,
        penghasilan: document.getElementById('penghasilan').value,
        namaBank: document.getElementById('namaBank').value,
        noRek: document.getElementById('noRek').value,
        namaAhli: document.getElementById('namaAhli').value,
        hubAhli: document.getElementById('hubAhli').value,
        kesehatan: document.getElementById('kesehatan').value,
        ktp: ktpBase64
      };
      if (!data2.ktp) return alert('Upload e-KTP dulu!');

      const fullData = { ...data1, ...data2 };
      const leader = new URLSearchParams(window.location.search).get('leader') || 'default';
      const waNumber = leaders[leader] || leaders.default;

      let msg = `Halo *${leader.toUpperCase()}*!%0A*MITRA BARU ISTIKMAL SYARIAH* ðŸŒ¿%0A%0A`;
      msg += `*Nama:* ${fullData.nama}%0A*NIK:* ${fullData.nik}%0A*HP:* ${fullData.hp}%0A*Alamat KTP:* ${fullData.alamatKtp}%0A*Domisili:* ${fullData.alamatDom || 'Sama'}%0A*Pekerjaan:* ${fullData.pekerjaan}%0A*Penghasilan:* ${fullData.penghasilan}%0A*Ibu Kandung:* ${fullData.ibu}%0A*Bank:* ${fullData.namaBank} - ${fullData.noRek}%0A*Ahli Waris:* ${fullData.namaAhli} (${fullData.hubAhli})%0A*Kesehatan:* ${fullData.kesehatan}%0A%0A*e-KTP:* [Lihat Foto KTP](${fullData.ktp})%0A%0AMohon closing ya Leader! ðŸ™`;

      // FIX NO BLOCK: Delay 1.5 detik + focus tab
      setTimeout(() => {
        const waTab = window.open(`https://wa.me/${waNumber}?text=${msg}`, '_blank');
        if (waTab) waTab.focus();
        alert('DATA TERKIRIM KE WA LEADER! Cek tab baru â€“ pesan full + e-KTP foto nyala!');
      }, 1500);

      window.location.href = "sukses.html";
    };
  </script>
</body>
</html>
