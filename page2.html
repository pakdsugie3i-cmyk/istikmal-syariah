<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Halaman 2 - Istikmal Syariah</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="assets/logo.png" type="image/png" />
</head>
<body>
  <div class="container">
    <div class="top">
      <img src="assets/logo.png" alt="Logo Istikmal" class="logo" />
      <h1>Formulir Istikmal Syariah<br><span class="sub">‚Äì 3IReborn</span></h1>
      <p>Lengkapi data tambahan & kirim ke leader Anda.</p>
    </div>
    <div class="card">
      <h2>Halaman 2 ‚Äì Data Tambahan</h2>
      <h3>Lengkapi Data & Kirim</h3>

      <!-- e-KTP UPLOAD BARU -->
      <h3>Upload Foto e-KTP üì∏</h3>
      <label for="ktp">Foto KTP (wajib, max 5MB)</label>
      <input type="file" id="ktp" accept="image/*" required>
      <div id="ktpPreview"></div>
      <br>

      <label for="alamatDom">Alamat Domisili (jika berbeda)</label>
      <input type="text" id="alamatDom" placeholder="Contoh: Jl. Sama dengan KTP" />

      <label for="pekerjaan">Pekerjaan</label>
      <input type="text" id="pekerjaan" placeholder="Contoh: Wiraswasta" required />

      <label for="penghasilan">Penghasilan /bulan</label>
      <input type="text" id="penghasilan" placeholder="Contoh: <50 jt" required />

      <label for="namaBank">Nama Bank</label>
      <input type="text" id="namaBank" placeholder="Contoh: BCA" required />

      <label for="noRek">No Rekening</label>
      <input type="text" id="noRek" placeholder="Contoh: 764621702" required />

      <label for="namaAhli">Nama Ahli Waris</label>
      <input type="text" id="namaAhli" placeholder="Contoh: Asha Kaba Aira (anak)" required />

      <label for="hubAhli">Hubungan Ahli Waris</label>
      <input type="text" id="hubAhli" placeholder="Contoh: Anak" required />

      <label for="kesehatan">Kesehatan (merokok?)</label>
      <select id="kesehatan" required>
        <option value="">Pilih</option>
        <option value="Tidak merokok">Tidak merokok</option>
        <option value="Merokok ringan">Merokok ringan</option>
        <option value="Merokok berat">Merokok berat</option>
      </select>

      <div class="confirm-box">
        <p>‚úÖ Saya setuju data benar & siap closing mitra Istikmal Syariah.</p>
      </div>

      <div class="actions two">
        <button id="backTo1" class="btn light">‚¨Ö Kembali</button>
        <button id="kirim" class="btn primary">Kirim ke Leader üöÄ</button>
      </div>
    </div>
    <div class="foot">¬© 2025 3IReborn ‚Äì Form Digital MLM Syariah</div>
  </div>

  <script src="leader.js"></script>
  <script>
    // Ambil data Halaman 1 dari localStorage
    const data1 = JSON.parse(localStorage.getItem('formData')) || {};

    // Preview e-KTP glow
    let ktpBase64 = '';
    document.getElementById('ktp').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.size < 5000000) { // Max 5MB
        const reader = new FileReader();
        reader.onload = function(ev) {
          ktpBase64 = ev.target.result;
          const preview = document.getElementById('ktpPreview');
          preview.innerHTML = `<img src="${ktpBase64}" alt="Preview KTP" style="max-width:100%; border-radius:15px; border:4px solid #00b09b; box-shadow:0 0 30px #00b09b;">`;
        };
        reader.readAsDataURL(file);
      } else {
        alert('File terlalu besar atau bukan gambar!');
      }
    });

    // Tombol Kembali bawa leader param
    document.getElementById('backTo1').onclick = function() {
      const params = new URLSearchParams(window.location.search);
      const leader = params.get('leader') ? '?leader=' + params.get('leader') : '';
      window.location.href = "index.html" + leader;
    };

    // Kirim ke WA leader
    document.getElementById('kirim').onclick = function() {
      const data2 = {
        alamatDom: document.getElementById('alamatDom').value,
        pekerjaan: document.getElementById('pekerjaan').value,
        penghasilan: document.getElementById('penghasilan').value,
        namaBank: document.getElementById('namaBank').value,
        noRek: document.getElementById('noRek').value,
        namaAhli: document.getElementById('namaAhli').value,
        hubAhli: document.getElementById('hubAhli').value,
        kesehatan: document.getElementById('kesehatan').value,
        ktp: ktpBase64
      };

      if (!data2.ktp) {
        alert('Upload foto e-KTP dulu ya!');
        return;
      }

      const fullData = { ...data1, ...data2 };
      const leader = new URLSearchParams(window.location.search).get('leader') || 'default';
      const waNumber = leaders[leader] || leaders.default;

      let msg = `Halo *${leader.toUpperCase()}*!%0A*MITRA BARU ISTIKMAL SYARIAH* üåø%0A%0A`;
      msg += `*Nama:* ${fullData.nama}%0A`;
      msg += `*NIK:* ${fullData.nik}%0A`;
      msg += `*HP:* ${fullData.hp}%0A`;
      msg += `*Alamat KTP:* ${fullData.alamatKtp}%0A`;
      msg += `*Domisili:* ${fullData.alamatDom || 'Sama'}%0A`;
      msg += `*Pekerjaan:* ${fullData.pekerjaan}%0A`;
      msg += `*Penghasilan:* ${fullData.penghasilan}%0A`;
      msg += `*Ibu Kandung:* ${fullData.ibu}%0A`;
      msg += `*Bank:* ${fullData.namaBank} - ${fullData.noRek}%0A`;
      msg += `*Ahli Waris:* ${fullData.namaAhli} (${fullData.hubAhli})%0A`;
      msg += `*Kesehatan:* ${fullData.kesehatan}%0A`;
      msg += `%0A*e-KTP:* [Lihat Foto KTP](${fullData.ktp})%0A%0A`;
      msg += `Mohon proses closing ya Leader! üôè`;

      window.open(`https://wa.me/${waNumber}?text=${msg}`, '_blank');
      window.location.href = "sukses.html";
    };
  </script>
</body>
</html>
